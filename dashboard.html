<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FichAppDo - Registro</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* [Todos los estilos anteriores] */
    :root {
      --primary-color: #4a4a4a;
      --secondary-color: #6a5acd;
      --background-light: #f4f7f6;
      --gradient-primary: linear-gradient(135deg, #6a5acd 0%, #8a4fff 100%);
      --status-active: #2ecc71;
      --status-inactive: #e74c3c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: var(--background-light);
      color: var(--primary-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

.container {
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 0 10px; /* Agrega un pequeño margen interno para pantallas pequeñas */
}

/* Ajustes específicos para pantallas pequeñas */
@media (max-width: 600px) {
  .container {
    padding: 0 15px; /* Aumenta el espacio interno en pantallas pequeñas */
  }
}

.user-header {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: #6a5acd;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

.user-info h2 {
  margin: 0 0 5px 0;
  font-size: 1.1em;
}

.user-info p {
  margin: 0 0 5px 0;
  color: #6c757d;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.9em;
}

.status-badge i {
  font-size: 0.7em;
}

.status-badge i.online {
  color: #28a745;
}

.status-badge i.offline {
  color: #dc3545;
}

    .status-section {
      background-color: white;
      border-radius: 15px;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .status-info {
      display: flex;
      flex-direction: column;
    }

    .status-label {
      font-size: 12px;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }

    .status-detail {
      font-weight: bold;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .status-active {
      background-color: var(--status-active);
    }

    .status-inactive {
      background-color: var(--status-inactive);
    }

    .main-action-button {
      width: 100%;
      padding: 20px;
      border: none;
      border-radius: 15px;
      background: var(--gradient-primary);
      color: white;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 10px 20px rgba(106, 90, 205, 0.2);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .main-action-button:active {
      transform: scale(0.98);
      box-shadow: 0 5px 10px rgba(106, 90, 205, 0.1);
    }

    .secondary-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .secondary-btn {
      background: none;
      border: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 15px;
      border-radius: 10px;
      background-color: #f1f3f4;
      color: var(--primary-color);
    }

    .secondary-btn i {
      font-size: 20px;
    }
    /* Añadir estilos para toast */
    #toastNotification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 30px;
      border-radius: 10px;
      z-index: 1000;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.5s ease-in-out;
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    #toastNotification.show {
      opacity: 1;
      transform: translateX(0);
    }

    #toastNotification.hide {
      opacity: 0;
      transform: translateX(100%);
    }

    /* Estilos para modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      width: 400px;
      max-width: 100%;
    }
      .admin-only .secondary-btn {
    background-color: #6a5acd  ; /* Cambia el color de fondo */
    color: white; /* Cambia el color del texto */
    border: 1px solid #8a4fff ; /* Bordes opcionales */
  }

  .admin-only .secondary-btn:hover {
    background-color: #9d4edd; /* Color al pasar el ratón */
    color: #fff; /* Color del texto al pasar el ratón */
  }

.panel-title {
  grid-column: 1 / -1; /* Ocupa todo el ancho de la cuadrícula */
  text-align: center;
  padding: 15px 0;
  background: white;
  color: black;
  border-radius: 10px;
  margin-bottom: 15px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.panel-title h3 {
  margin: 0;
  font-size: 1.2em;
  font-weight: bold;
}

.secondary-actions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  align-items: start; /* Alinea los elementos al inicio */
}
  // NUEVOS ESTILOS
  /* Estilos comunes para todos los botones */
.button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 15px 20px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
  color: white;
  background-color: var(--secondary-color);
  transition: background-color 0.3s ease, transform 0.2s ease;
  cursor: pointer;
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
}

.button:hover {
  background-color: #9d4edd;
}

.button:active {
  transform: scale(0.97);
  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
}

/* Botones principales */
.main-button {
  background: var(--gradient-primary);
  font-size: 18px;
  
}

.main-button:hover {
  background: linear-gradient(135deg, #5a47a0 0%, #7b37f6 100%);
}

/* Botones secundarios */
.secondary-button {
  background-color: #f1f3f4;
  color: var(--primary-color);
  font-size: 14px;
}

.secondary-button:hover {
  background-color: #e9ecef;
  color: var(--secondary-color);
}

/* Botones solo para administrador */
.admin-button {
  background-color: var(--secondary-color);
  color: white;
}

.admin-button:hover {
  background-color: #9d4edd;
}


/* Botón de Entrada (Verde) */
.entry-button {
  background-color: #c8e6c9; /* Verde claro más oscuro */
  color: #1B5E20; /* Verde muy oscuro para el texto */
  border: 1px solid #4CAF50; /* Borde en tono verde */
  transition: all 0.3s ease;
}

.entry-button:hover {
  background-color: #4CAF50; /* Tono más oscuro al pasar */
  color: white;
  box-shadow: 0 4px 6px rgba(27, 94, 32, 0.2);
}

.entry-button:active {
  background-color: #2E7D32; /* Tono aún más oscuro al presionar */
  transform: scale(0.98);
}

/* Botón de Salida (Rojo) */
.exit-button {
  background-color: #ffcdd2; /* Rojo claro más oscuro */
  color: #b71c1c; /* Rojo muy oscuro para el texto */
  border: 1px solid #ef5350; /* Borde en tono rojo */
  transition: all 0.3s ease;
}

.exit-button:hover {
  background-color: #ef5350; /* Tono más oscuro al pasar */
  color: white;
  box-shadow: 0 4px 6px rgba(183, 28, 28, 0.2);
}

.exit-button:active {
  background-color: #d32f2f; /* Tono aún más oscuro al presionar */
  transform: scale(0.98);
} 
  </style>

</head>
<body>

<div class="container">  
   <!-- Toast Notification -->
    <div id="toastNotification"></div>


  <div class="user-header">
    <div class="user-avatar" id="userInitials">FF</div>
    <div class="user-info">
      <h2 id="userName">Nombre Usuario</h2>
      <p id="userEmail">usuario@empresa.com</p>
      <div class="user-status">
        <span>Último estado antes de la conexión: </span>
        <span id="userStatusIndicator" class="status-badge">
          <i class="fas fa-circle"></i>
          <span id="userStatusText">Estado</span>
        </span>
      </div>
    </div>
  </div>
      



    
  <!-- Botones principales -->
  <div class="container">
    <div class="panel-title">
      <h3> Panel de Usuario </h3>
    </div>
    <button id="btnEntrada" class="button entry-button" onclick="registrarEntrada()">
      <i class="fas fa-sign-in-alt"></i> Registrar Entrada
    </button>
    <button id="btnSalida" class="button exit-button" onclick="registrarSalida()">
      <i class="fas fa-sign-out-alt"></i> Registrar Salida
    </button>
  

    <!-- Opciones de usuario -->
    <div class="secondary-actions">
      <button class="button main-button" onclick="cambiarPassword()">
        <i class="fas fa-key"></i>
        <span>Cambiar Contraseña</span>
      </button>
      <button class="button main-button" onclick="generarInforme()">
        <i class="fas fa-file-alt"></i>
        <span>Mis Informes</span>
      </button>
      <button class="button main-button" onclick="LogOut()">
        <i class="fas fa-power-off"></i>
        <span>Cerrar Sesión</span>
      </button>
    </div>
  

    <!-- Opciones de Administrador -->
    <div id="adminActions" class="secondary-actions" style="display:none;">
      <div class="panel-title">
        <h3> Panel de Administrador </h3>
      </div>
      <button class="button main-button" onclick="mostrarCrearUsuario()">
        <i class="fas fa-user-plus"></i>
        <span>Crear Usuario</span>
      </button>
      <button class="button main-button" onclick="mostrarResetUsuario()">
        <i class="fas fa-user-lock"></i>
        <span>Reset Usuario</span>
      </button>
        <button class="button main-button" onclick="mostrarBajaUsuario()">
        <i class="fas fa-user-times"></i>
        <span>Dar de Baja</span>
      </button>
      <button class="button main-button" onclick="generarInformesGenerales()">
        <i class="fas fa-file-alt"></i>
        <span>Informes Generales</span>
      </button>
      <button class="button main-button" onclick="FUNCION()">
        <i class="fas fa-file-alt"></i>
        <span>Añadir Incidencia</span>
      </button>
        <button class="button main-button" onclick="FUNCION()">
        <i class="fas fa-file-alt"></i>
        <span>Boton 2</span>
      </button>
    </div>
  </div>
 </div>


 
  

<script>
    // Función para mostrar notificación toast
    function mostrarToast(mensaje, opciones = {}) {
        let toast = document.getElementById('toastNotification');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'toastNotification';
            document.body.appendChild(toast);
        }

        const defaults = {
            tipo: 'success',
            duracion: 3000,
        };

        const config = { ...defaults, ...opciones };
        
        const estilos = {
            'success': { 
                backgroundColor: '#28a745', 
                color: 'white' 
            },
            'error': { 
                backgroundColor: '#dc3545', 
                color: 'white' 
            },
            'warning': { 
                backgroundColor: '#ffc107', 
                color: '#212529' 
            },
            'info': { 
                backgroundColor: '#17a2b8', 
                color: 'white' 
            }
        };

        toast.className = '';
        Object.assign(toast.style, estilos[config.tipo] || estilos['success']);
        toast.textContent = mensaje;
        toast.classList.add('toastNotification', 'show');

        setTimeout(() => {
            toast.classList.remove('show');
            toast.classList.add('hide');
        }, config.duracion);
    }



    function registrarEntrada() {
        google.script.run
            .withSuccessHandler(function(resultado) {
                if (resultado.success) {
                    mostrarToast('Entrada registrada correctamente', { tipo: 'success' });
                    //cargarDatosUsuario() //Carga los datos de otro usuario si esta en online.
                } else {
                    mostrarToast(resultado.mensaje || 'Error al registrar entrada', { tipo: 'error' });
                }
            })
            .withFailureHandler(function(error) {
                mostrarToast('Error de conexión al registrar entrada', { tipo: 'error' });
            })
            .registrarEntrada();
    }

    function registrarSalida() {
        google.script.run
            .withSuccessHandler(function(resultado) {
                if (resultado.success) {
                    mostrarToast('Salida registrada correctamente', { tipo: 'success' });
                   // cargarDatosUsuario() //Carga los datos de otro usuario si esta en online.
                } else {
                    mostrarToast(resultado.mensaje || 'Error al registrar salida', { tipo: 'error' });
                }
            })
            .withFailureHandler(function(error) {
                mostrarToast('Error de conexión al registrar salida', { tipo: 'error' });
            })
            .registrarSalida();
    }

function cambiarPassword() {
    const modal = document.createElement('div');
    modal.innerHTML = `
        <div class="modal-overlay">
            <div class="modal-container">
                <h2>Cambiar Contraseña</h2>
                <form id="formCambioContraseña">
                    <div style="margin-bottom: 15px;">
                        <label>Contraseña Actual:</label>
                        <input type="password" id="currentPassword" required 
                               style="width: 100%; padding: 8px; margin-top: 5px;"
                               minlength="4">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Contraseña Nueva:</label>
                        <input type="password" id="newPassword" required 
                               style="width: 100%; padding: 8px; margin-top: 5px;"
                               minlength="4">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Confirmar Nueva Contraseña:</label>
                        <input type="password" id="confirmNewPassword" required 
                               style="width: 100%; padding: 8px; margin-top: 5px;"
                               minlength="4">
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <button type="submit" 
                                style="background: var(--gradient-primary); color: white; padding: 10px 20px; border: none; border-radius: 5px;">
                            Cambiar Contraseña
                        </button>
                        <button type="button" 
                                style="background: #f1f3f4; color: var(--primary-color); padding: 10px 20px; border: none; border-radius: 5px;" 
                                onclick="this.closest('.modal-overlay').remove()">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    document.getElementById('formCambioContraseña').addEventListener('submit', function(e) {
        e.preventDefault();

        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;

        // Validaciones básicas
        if (newPassword.length < 4) {
            mostrarToast('La contraseña debe tener al menos 4 caracteres', { tipo: 'error' });
            return;
        }

        if (newPassword !== confirmNewPassword) {
            mostrarToast('Las contraseñas no coinciden', { tipo: 'error' });
            return;
        }

        // Evitar que sea igual a la contraseña actual
        if (currentPassword === newPassword) {
            mostrarToast('La nueva contraseña no puede ser igual a la contraseña actual', { tipo: 'error' });
            return;
        }

        // Llamada al servidor para cambiar la contraseña
        google.script.run
            .withSuccessHandler(function(resultado) {
                if (resultado.success) {
                    mostrarToast('Contraseña cambiada exitosamente', { tipo: 'success' });
                    document.querySelector('.modal-overlay').remove();
                } else {
                    mostrarToast('Error al cambiar contraseña: ' + resultado.mensaje, { tipo: 'error' });
                }
            })
            .withFailureHandler(function(error) {
                mostrarToast('Error de conexión al cambiar contraseña', { tipo: 'error' });
            })
            .cambiarPasswordUsuario(currentPassword, newPassword);
    });
}
//Generar MisInformes
function generarInforme() {
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal-container" style="max-width: 400px;">
        <h2>Generar Informe Personal</h2>
        <form id="formGenerarInforme">
          <div style="margin-bottom: 15px;">
            <label>Selecciona el Mes:</label>
            <select id="selectMes" required style="width: 100%; padding: 10px; margin-top: 5px;">
              <option value="">Selecciona un mes</option>
              <option value="1">Enero</option>
              <option value="2">Febrero</option>
              <option value="3">Marzo</option>
              <option value="4">Abril</option>
              <option value="5">Mayo</option>
              <option value="6">Junio</option>
              <option value="7">Julio</option>
              <option value="8">Agosto</option>
              <option value="9">Septiembre</option>
              <option value="10">Octubre</option>
              <option value="11">Noviembre</option>
              <option value="12">Diciembre</option>
            </select>
          </div>
          <div style="margin-bottom: 15px;">
            <label>Año:</label>
            <select id="selectAno" required style="width: 100%; padding: 10px; margin-top: 5px;">
              <!-- Se poblará dinámicamente con años -->
            </select>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <button type="submit" style="background: var(--gradient-primary); color: white; padding: 10px 20px; border: none; border-radius: 5px;">
              Generar Informe
            </button>
            <button type="button" style="background: #f1f3f4; color: var(--primary-color); padding: 10px 20px; border: none; border-radius: 5px;" onclick="this.closest('.modal-overlay').remove()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Poblar años (desde 2023 hasta el año actual)
  const selectAno = document.getElementById('selectAno');
  const añoActual = new Date().getFullYear();
  for (let año = 2023; año <= añoActual; año++) {
    const option = document.createElement('option');
    option.value = año;
    option.textContent = año;
    if (año === añoActual) option.selected = true;
    selectAno.appendChild(option);
  }
  
  document.getElementById('formGenerarInforme').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const mes = document.getElementById('selectMes').value;
    const año = document.getElementById('selectAno').value;
    
    if (!mes) {
      mostrarToast('Por favor, selecciona un mes', { tipo: 'error' });
      return;
    }
    
    // Llamada al servidor para generar informe
    google.script.run
      .withSuccessHandler(function(url) {
        // Abrir el PDF generado en una nueva pestaña
        window.open(url, '_blank');
        // Cerrar el modal
        document.querySelector('.modal-overlay').remove();
      })
      .withFailureHandler(function(error) {
        mostrarToast('Error al generar informe: ' + error, { tipo: 'error' });
      })
      .generarInformePersonal(parseInt(mes), parseInt(año));
  });
}

//Genera Informes Generales
function generarInformesGenerales() {
  const modalDiv = document.createElement('div');
  modalDiv.className = 'modal-overlay';
  
  modalDiv.innerHTML = `
    <div class="modal-container" style="width: 400px;">
      <h2>Generación de Informes</h2>
      <form id="formInformesGenerales">
        <div style="margin-bottom: 15px;">
          <label>Tipo de Informe:</label>
          <select id="tipoInforme" required style="width: 100%; padding: 8px; margin-top: 5px;">
            <option value="global">Informe Global</option>
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label>Seleccionar Mes y Año:</label>
          <input type="month" id="periodoInforme" required style="width: 100%; padding: 8px;">
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
          <button type="submit" style="background: var(--gradient-primary); color: white; padding: 10px 20px; border: none; border-radius: 5px;">
            Generar Informe
          </button>
          <button type="button" id="btnCerrarModal" style="background: #f1f3f4; color: var(--primary-color); padding: 10px 20px; border: none; border-radius: 5px;">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  `;
  
  document.body.appendChild(modalDiv);
  
  document.getElementById('btnCerrarModal').addEventListener('click', function() {
    document.body.removeChild(modalDiv);
  });
  
  document.getElementById('formInformesGenerales').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const periodoSeleccionado = document.getElementById('periodoInforme').value;
    const [año, mes] = periodoSeleccionado.split('-').map(Number);
    
    const datosInforme = {
      tipoInforme: 'global',
      fechaInicio: periodoSeleccionado + '-01'
    };
    
    google.script.run.withSuccessHandler(function(resultado) {
      if (resultado.success) {
        window.open(resultado.url, '_blank');
        document.body.removeChild(modalDiv);
        mostrarToast('Informe generado correctamente', { tipo: 'success' });
      } else {
        mostrarToast('Error al generar informe: ' + resultado.mensaje, { tipo: 'error' });
      }
    }).generarInformeGeneral(datosInforme);
  });
}

/* **************************************

//CARGAR INFORMACIÓN

************************************************************** */
$(document).ready(function() {
  cargarDatosUsuario(); // Llama a la función para cargar los datos del usuario
});

//Admin
function mostrarCrearUsuario() {
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal-container">
        <h2>Crear Nuevo Usuario</h2>
        <form id="formCrearUsuario">
          <div style="margin-bottom: 15px;">
            <label>Email:</label>
            <input type="email" id="nuevoUsuarioEmail" required style="width: 100%; padding: 8px; margin-top: 5px;">
          </div>
          <div style="margin-bottom: 15px;">
            <label>Nombre:</label>
            <input type="text" id="nuevoUsuarioNombre" required style="width: 100%; padding: 8px; margin-top: 5px;">
          </div>
          <div style="margin-bottom: 15px;">
            <label>Departamento:</label>
            <input type="text" id="nuevoUsuarioDepartamento" required style="width: 100%; padding: 8px; margin-top: 5px;">
          </div>
          <div style="margin-bottom: 15px;">
            <label>Rol:</label>
            <select id="nuevoUsuarioRol" required style="width: 100%; padding: 8px; margin-top: 5px;">
              <option value="Usuario">Usuario</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <button type="submit" style="background: var(--gradient-primary); color: white; padding: 10px 20px; border: none; border-radius: 5px;">Crear Usuario</button>
            <button type="button" style="background: #f1f3f4; color: var(--primary-color); padding: 10px 20px; border: none; border-radius: 5px;" onclick="this.closest('.modal-overlay').remove()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('formCrearUsuario').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const datosUsuario = {
      email: document.getElementById('nuevoUsuarioEmail').value,
      nombre: document.getElementById('nuevoUsuarioNombre').value,
      departamento: document.getElementById('nuevoUsuarioDepartamento').value,
      rol: document.getElementById('nuevoUsuarioRol').value
    };
    
    google.script.run.withSuccessHandler(function(resultado) {
      if (resultado.success) {
        mostrarToast('Usuario creado exitosamente', { tipo: 'success' });
        document.querySelector('.modal-overlay').remove();
      } else {
        mostrarToast('Error al crear usuario: ' + resultado.mensaje, { tipo: 'error' });
      }
    }).crearNuevoUsuario(datosUsuario);
  });
}

function mostrarResetUsuario() {
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div class="modal-overlay">
      <div class="modal-container">
        <h2>Reset de Usuario</h2>
        <form id="formResetUsuario">
          <div style="margin-bottom: 15px;">
            <label>Email del Usuario:</label>
            <input type="email" id="resetUsuarioEmail" required style="width: 100%; padding: 8px; margin-top: 5px;" placeholder="Introduce el email del usuario">
          </div>
          <div style="display: flex; justify-content: space-between;">
            <button type="submit" style="background: var(--gradient-primary); color: white; padding: 10px 20px; border: none; border-radius: 5px;">Resetear Contraseña</button>
            <button type="button" style="background: #f1f3f4; color: var(--primary-color); padding: 10px 20px; border: none; border-radius: 5px;" onclick="this.closest('.modal-overlay').remove()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  document.getElementById('formResetUsuario').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const emailUsuario = document.getElementById('resetUsuarioEmail').value;
    
    google.script.run.withSuccessHandler(function(resultado) {
      if (resultado.success) {
        mostrarToast('Contraseña reseteada exitosamente', { tipo: 'success' });
        document.querySelector('.modal-overlay').remove();
      } else {
        mostrarToast('Error al resetear contraseña: ' + resultado.mensaje, { tipo: 'error' });
      }
    }).resetearPasswordUsuario(emailUsuario);
  });
}


// Modificar la función cargarDatosUsuario para mostrar/ocultar acciones de admin
// ************* Cargadar datos Admin *********************
// ********************************************************
function cargarDatosUsuario() {
  google.script.run
    .withSuccessHandler(function(datosUsuario) {
      console.log('Datos del usuario recibidos:', datosUsuario);
      
      if (datosUsuario) {
        $('#userName').text(datosUsuario.nombre);
        $('#userEmail').text(datosUsuario.email);
        $('#userInitials').text(
          datosUsuario.nombre.split(' ')
            .map(n => n[0])
            .join('')
            .toUpperCase()
        );
    
        // Mostrar u ocultar sección de acciones de admin
        $('#adminActions').css('display', datosUsuario.rol === 'Admin' ? 'grid' : 'none');

        // Verificar estado de conexión
        google.script.run.withSuccessHandler(function(ultimoRegistro) {
          const $statusIndicator = $('#userStatusIndicator i');
          const $statusText = $('#userStatusText');

          if (ultimoRegistro && ultimoRegistro.tipo === 'Entrada') {
            $statusIndicator.removeClass('offline').addClass('online');
            $statusText.text('Trabajando...');
          } else {
            $statusIndicator.removeClass('online').addClass('offline');
            $statusText.text('No Trabajando...');
          }
        }).obtenerUltimoRegistroEntradaSalida(datosUsuario.email);

      } else {
        console.error('No se recibieron datos de usuario');
      }
    })
    .withFailureHandler(function(error) {
      console.error('Error al obtener datos de usuario:', error);
      alert('Error al cargar los datos de usuario: ' + error);
    })
    .obtenerDatosUsuarioActual();
}

</script>
</body>
</html>
